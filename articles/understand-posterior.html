<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Understand posterior estimates • Pv3Rs</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Understand posterior estimates">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Pv3Rs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/demonstrate-usage.html">Demonstrate Pv3Rs usage</a></li>
    <li><a class="dropdown-item" href="../articles/intra-episode-siblings.html">Explore treatment of intra-episode siblings</a></li>
    <li><a class="dropdown-item" href="../articles/understand-posterior.html">Understand posterior estimates</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/aimeertaylor/Pv3Rs/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Understand posterior estimates</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/aimeertaylor/Pv3Rs/blob/main/vignettes/articles/understand-posterior.Rmd" class="external-link"><code>vignettes/articles/understand-posterior.Rmd</code></a></small>
      <div class="d-none name"><code>understand-posterior.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="summary-of-contents">Summary of contents<a class="anchor" aria-label="anchor" href="#summary-of-contents"></a>
</h2>
<p>In this vignette we document the output of
<code>compute_posterior</code> when the statistical model underpinning
it is well specified and misspecified. Specifically, we document the
output of <code>compute_posterior</code> when the model is well
specified but</p>
<ul>
<li>data are missing,</li>
<li>data are uninformative,</li>
<li>data are limited to only one episode,</li>
<li>data are incomparable across episodes,</li>
<li>data are limited to only one marker.</li>
</ul>
<p>When the model is well specified and there are data on many markers,
we show how the maximum probability of recrudescence / reinfection
depends on</p>
<ul>
<li>per-episode genotype counts (i.e., multiplicities of infections,
MOIs),</li>
<li>episode count,</li>
<li>the position of a recurrence in a sequence of episodes,</li>
</ul>
<p>and thus comment on how the above dependencies impact the</p>
<ul>
<li>interpretation of uncertainty.</li>
</ul>
<p>Finally, we summarise results on the output of
<code>compute_posterior</code> when the model is misspecified because
of</p>
<ul>
<li>meiotic siblings,</li>
<li>half siblings,</li>
<li>parent child-like siblings,</li>
<li>genotyping errors and <em>de novo</em> mutations [To-do].</li>
</ul>
<p>For the more detailed result, see [development files of the Pv3Rs
source package] (<a href="https://github.com/aimeertaylor/Pv3Rs/tree/main/DevFiles/RelationshipStudy" class="external-link uri">https://github.com/aimeertaylor/Pv3Rs/tree/main/DevFiles/RelationshipStudy</a>).
We have not characterised model misspecification due to inbred
parasites. Allele frequency estimates encode population-level
relatedness locus-by-locus (<a href="https://doi.org/10.1093/g3journal/jkaf018" class="external-link">Mehra et al. 2025</a>).
Allele frequency estimates are plugged into the statistical model
underpinning Pv3Rs. Providing they are computed from a sample drawn from
the parasite population from which trial participants also draw, there
is no need to compensate further for elevated relatedness locus-by-locus
on the population level. However, inter-locus dependence (linkage
disequilibrium) is liable to generate overconfident posterior
probabilities. Population structure (e.g., household effects) could lead
to the misclassification of reinfection as relapse / recrudescence. In
our view, recurrence classification in the presence of population
structure is best understood using complementary population genetic and
sensitivity analyses.</p>
</div>
<div class="section level2">
<h2 id="missing-data">Missing data<a class="anchor" aria-label="anchor" href="#missing-data"></a>
</h2>
<p>When data are entirely missing, <code>compute_posterior</code>
returns the prior.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="co"># Allele frequencies</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>, recur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="co"># Missing data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span> <span class="co"># Posterior</span></span>
<span><span class="co">#&gt;               C         L         I</span></span>
<span><span class="co">#&gt; recur 0.3333333 0.3333333 0.3333333</span></span></code></pre></div>
<p>When data are missing but the user provides MOIs that are
incompatible with recrudescence, <code>compute_posterior</code> returns
the prior re-weighted to the exclusion of recrudescence.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">fs</span>, MOIs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span> </span>
<span><span class="co">#&gt;       C   L   I</span></span>
<span><span class="co">#&gt; recur 0 0.5 0.5</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="uniformative-data">Uniformative data<a class="anchor" aria-label="anchor" href="#uniformative-data"></a>
</h2>
<p>When data are entirely uninformative because there is no genetic
diversity, <code>compute_posterior</code> returns the prior.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Unit allele frequency: no genetic diversity</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>, recur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Data: not missing</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span> <span class="co"># Posterior</span></span>
<span><span class="co">#&gt;               C         L         I</span></span>
<span><span class="co">#&gt; recur 0.3333333 0.3333333 0.3333333</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-on-only-one-episode">Data on only one episode<a class="anchor" aria-label="anchor" href="#data-on-only-one-episode"></a>
</h2>
<div class="section level3">
<h3 id="homoallelic-data-without-user-specified-mois-prior-return">Homoallelic data without user-specified MOIs: prior return<a class="anchor" aria-label="anchor" href="#homoallelic-data-without-user-specified-mois-prior-return"></a>
</h3>
<p>When only one episode has homoallelic data and the user does not
specify an MOI &gt; 1, <code>compute_posterior</code> returns the
prior.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="co"># Allele frequencies</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>, recur1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span><span class="op">)</span> <span class="co"># No enrolment data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span> <span class="co"># Posterior</span></span>
<span><span class="co">#&gt;                C         L         I</span></span>
<span><span class="co">#&gt; recur1 0.3333333 0.3333333 0.3333333</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="heteroallelic-data-prior-proximity">Heteroallelic data: prior proximity<a class="anchor" aria-label="anchor" href="#heteroallelic-data-prior-proximity"></a>
</h3>
<p>When only one episode has heteroallelic data, the MOI under the model
necessarily exceeds one because the model assumes no false positivity.
The posterior is close to the prior but not equal to it because the data
are slightly informative: for relationship graphs with intra-episode
siblings, heteroallelic data limit summation over identity-by-descent
partitions to partitions with at least two cells for the episode with
data. The lower bound on the cell count increases with the number of
distinct alleles observed.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Allele frequencies </span></span>
<span><span class="va">fs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span> <span class="op">=</span> <span class="fl">0.25</span>, <span class="st">'B'</span> <span class="op">=</span> <span class="fl">0.25</span>, <span class="st">'C'</span> <span class="op">=</span> <span class="fl">0.25</span>, <span class="st">'D'</span> <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># MOI at enrolment increases with number of observed alleles:  </span></span>
<span><span class="va">yMOI2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span><span class="op">)</span><span class="op">)</span>, recur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">yMOI3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span><span class="op">)</span><span class="op">)</span>, recur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">yMOI4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>,<span class="st">'D'</span><span class="op">)</span><span class="op">)</span>, recur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">yMOI2</span>, <span class="va">yMOI3</span>, <span class="va">yMOI4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ys</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt;               C         L         I</span></span>
<span><span class="co">#&gt; recur 0.3292683 0.3414634 0.3292683</span></span>
<span><span class="co">#&gt; recur 0.3260870 0.3478261 0.3260870</span></span>
<span><span class="co">#&gt; recur 0.3248359 0.3503282 0.3248359</span></span>
<span></span>
<span><span class="co"># MOI increases with external input:</span></span>
<span><span class="va">MOIs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># user-specified MOIs</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span><span class="op">)</span><span class="op">)</span>, recur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="co"># Data </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">MOIs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">fs</span>, MOIs <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt;               C         L         I</span></span>
<span><span class="co">#&gt; recur 0.3292683 0.3414634 0.3292683</span></span>
<span><span class="co">#&gt; recur 0.3250000 0.3500000 0.3250000</span></span>
<span><span class="co">#&gt; recur 0.3334508 0.3330983 0.3334508</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="rare-homoallelic-data-with-user-specified-mois-exceeding-1-prior-departure">Rare homoallelic data with user-specified MOIs exceeding 1: prior
departure<a class="anchor" aria-label="anchor" href="#rare-homoallelic-data-with-user-specified-mois-exceeding-1-prior-departure"></a>
</h3>
<p>If the data are homoallelic, but the user specifies MOIs greater than
one, and the observed allele is rare, the posterior departs from the
prior because rare intra-episode allelic repeats are more probable given
relationship graphs with intra-episode relatedness.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span>, recur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="co"># Homoallelic data</span></span>
<span><span class="va">MOIs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Different MOIs with first MOI &gt; 1</span></span>
<span><span class="va">fs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span> <span class="co"># Rare observed allele</span></span></code></pre></div>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-10-1.png" width="100%"></p>
<p>The per-graph likelihood is only appreciable for relationship graphs
where all distinct parasite genotypes in the first episode are
siblings</p>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-11-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="data-are-incomparable-across-episodes">Data are incomparable across episodes<a class="anchor" aria-label="anchor" href="#data-are-incomparable-across-episodes"></a>
</h2>
<p>When there are data on multiple episodes but no comparable data
across episodes, <code>compute_posterior</code> behaves similarly to
when data are limited to one episode:</p>
<ul>
<li>it returns the prior when data are homoallelic without
user-specified MOIs &gt; 1,</li>
<li>its output remains close to the prior when data are
heteroallelic,</li>
<li>its output departs from the prior when data are homoallelic and rare
with user-specified MOIs &gt; 1.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Allele frequencies</span></span>
<span><span class="va">fs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span>, </span>
<span>          m2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Data with an incomparable homoallelic call</span></span>
<span><span class="va">y_hom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">"A"</span>, m2 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>, </span>
<span>              recur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span>, m2 <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data with an incomparable heteroallelic call</span></span>
<span><span class="va">y_het</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, m2 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>, </span>
<span>              recur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span>, m2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">y_hom</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span> <span class="co"># Prior return </span></span>
<span><span class="co">#&gt;               C         L         I</span></span>
<span><span class="co">#&gt; recur 0.3333333 0.3333333 0.3333333</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">y_het</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span> <span class="co"># Prior proximity</span></span>
<span><span class="co">#&gt;               C         L         I</span></span>
<span><span class="co">#&gt; recur 0.3370787 0.3595506 0.3033708</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">y_hom</span>, <span class="va">fs</span>, MOIs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span> <span class="co"># Prior departure</span></span>
<span><span class="co">#&gt;               C         L        I</span></span>
<span><span class="co">#&gt; recur 0.5142862 0.2183909 0.267323</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-on-only-one-marker">Data on only one marker<a class="anchor" aria-label="anchor" href="#data-on-only-one-marker"></a>
</h2>
<p>When data on a single marker are comparable across episodes, the
output of <code>compute_posterior</code> depends on the observation type
and the frequencies of the observed alleles. For example,</p>
<ul>
<li>A rare match is informative: it quashes the posterior probability of
reinfection.</li>
<li>A partial rare match is also informative, quashing the posterior
probability of reinfection.</li>
<li>A match with a common allele is not very informative: all states are
possible <em>a posteriori</em>.</li>
<li>A partial match with a common allele is not very informative: all
states are possible <em>a posteriori</em>.</li>
<li>A mismatch is informative: it quashes the posterior probability of
recrudescence.</li>
</ul>
<p>The latter demonstrates the sensitivity of recrudescence inference to
the assumption under the model that there are no genotyping errors: if a
genotyping error generates a single mismatch, the posterior probability
of recrudescence is quashed.</p>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-13-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="data-on-only-two-markers">Data on only two markers<a class="anchor" aria-label="anchor" href="#data-on-only-two-markers"></a>
</h2>
<p>When data on a second marker are added and the second observation is
consistent with the first the strength of inference generally increases
(see arrows in or entering regions of posterior probability greater than
0.5); an exception being the addition of a common match to a common
partial match, which is not very informative (central arrow). When a
mismatch is added to a rare match (diamond), relapse becomes the most
probable state. This demonstrates the requirement of multiple markers
for relapse inference.</p>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-14-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="data-on-many-markers">Data on many markers<a class="anchor" aria-label="anchor" href="#data-on-many-markers"></a>
</h2>
<p>Given non-zero prior probabilities, as the data increase with the
number of markers genotyped, posterior probabilities for a given
recurrence converge to either</p>
<ol style="list-style-type: decimal">
<li><p>relapse with posterior probability one when the data suggest the
episode of interest is linked to previous episodes by regular sibling
relationships</p></li>
<li><p>recrudescence with posterior probability less than one when the
data suggest the episode of interest is linked to the previous episode
by clonal relationships</p></li>
<li><p>reinfection with posterior probability less than one when the
data suggest the episode or interest is not linked to previous episodes
by regular sibling or clonal relationships</p></li>
</ol>
<p>Recrudescence / reinfection probabilities necessarily converge to
uncertain values because genetic data compatible with recrudescence /
reinfection are also compatible with relapse.</p>
<div class="section level3">
<h3 id="posterior-bounds">Posterior bounds<a class="anchor" aria-label="anchor" href="#posterior-bounds"></a>
</h3>
<p>Because we assume <em>a priori</em> that relationship graphs
compatible with a given recurrent state sequence are uniformly
distributed, and because relationship graphs compatible with sequences
of recrudescence / reinfection are a subset of those compatible with
sequences of relapse, bounds induced by the prior on non-marginal
posterior probabilities can be computed <em>a priori</em> as a function
of the prior on the recurrent state sequences and the prior on the
relationship graphs; see vignette(topic = “graph-prior”, package =
“Pv3Rs”). <!-- no back
ticks because pkgdown cannot link to pdf vignettes --></p>
<p>Because the probability mass function of a uniformly distributed
discrete random variable depends on the size of its support, the prior
on uniformly distributed graphs (and thus bounds on the posterior
induced by the prior) depends on the size of the graph space. Graph
space size depends on constitute graph size (all graphs within a space
are the same size). Graphs have as many vertices as parasite genotypes
within and across episodes. As such, graph size depends on episode
counts and per-episode MOIs, which vary across trial participants.</p>
<p>Using rare matched and mismatched data on 100 markers, we demonstrate
the dependency on per-episode MOIs of prior-induced posterior bounds for
a single recurrence. We also demonstrate how maximum marginal
probabilities of recrudescence / relapse depend on episode counts by
adding recurrences with no recurrent data. However, these maxima are
based on knowledge that there are no recurrent data on all but the first
recurrence. In other words, they are not computable <em>a
priori</em>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marker_count</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># Number of markers</span></span>
<span><span class="va">ms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">marker_count</span><span class="op">)</span> <span class="co"># Marker names </span></span>
<span><span class="va">all_As</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ms</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="st">"A"</span>, simplify <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co"># As for all markers</span></span>
<span><span class="va">all_Bs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ms</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="st">"B"</span>, simplify <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co"># Bs for all markers</span></span>
<span><span class="va">no_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ms</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="cn">NA</span>, simplify <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co"># NAs for all markers</span></span>
<span><span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ms</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="increasing-per-episode-mois">Increasing per-episode MOIs<a class="anchor" aria-label="anchor" href="#increasing-per-episode-mois"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MOIs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">y_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, recur <span class="op">=</span> <span class="va">all_As</span><span class="op">)</span></span>
<span><span class="va">y_mismatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, recur <span class="op">=</span> <span class="va">all_Bs</span><span class="op">)</span></span></code></pre></div>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-18-1.png" width="100%"></p>
<p>The posterior probabilities of recrudescence increase with increasing
graph size when the MOIs are balanced. The posterior probabilities of
reinfection increase with increasing graph size.</p>
<div class="section level4">
<h4 id="digression-counts-of-intra-episode-siblings">Digression: counts of intra-episode siblings<a class="anchor" aria-label="anchor" href="#digression-counts-of-intra-episode-siblings"></a>
</h4>
<p>To increase per-episode MOIs, we can do as above and increase
user-specified MOIs without changing the data, or we can increase the
allelic diversity of the data, s.t. MOIs modelled under Pv3Rs increase
without user-specified MOIs. Either way, we get the same maximum
probabilities:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_ACs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ms</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co"># A&amp;C for all </span></span>
<span><span class="va">all_BEs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ms</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"E"</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co"># A&amp;C for all </span></span>
<span><span class="va">all_ACDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ms</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co"># A&amp;C for all </span></span>
<span><span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ms</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"C"</span> <span class="op">=</span> <span class="fl">0.01</span>, </span>
<span>                               <span class="st">"D"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"E"</span> <span class="op">=</span> <span class="fl">0.96</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hom_match_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, hom_match_data <span class="op">=</span> <span class="va">all_As</span><span class="op">)</span></span>
<span><span class="va">het_match_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_ACDs</span>, het_match_data <span class="op">=</span> <span class="va">all_ACs</span><span class="op">)</span></span>
<span><span class="va">hom_mismatch_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, hom_mismatch_data <span class="op">=</span> <span class="va">all_Bs</span><span class="op">)</span></span>
<span><span class="va">het_mismatch_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_ACDs</span>, het_mismatch_data <span class="op">=</span> <span class="va">all_BEs</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">hom_match_data</span>, <span class="va">fs</span>, MOIs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span><span class="op">)</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">het_match_data</span>, <span class="va">fs</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span><span class="op">)</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">hom_mismatch_data</span>, <span class="va">fs</span>, MOIs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">het_mismatch_data</span>, <span class="va">fs</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                           C          L             I</span></span>
<span><span class="co">#&gt; hom_match_data    0.8514851 0.14851485 9.084162e-231</span></span>
<span><span class="co">#&gt; het_match_data    0.8514851 0.14851485  0.000000e+00</span></span>
<span><span class="co">#&gt; hom_mismatch_data 0.0000000 0.05494505  9.450549e-01</span></span>
<span><span class="co">#&gt; het_mismatch_data 0.0000000 0.05494505  9.450549e-01</span></span></code></pre></div>
<p>But the graph likelihoods change:</p>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-20-1.png" width="100%"><img src="understand-posterior_files/figure-html/unnamed-chunk-20-2.png" width="100%"></p>
<p>For the homoallelic data with elevated user-specified MOIs, all
intra-episode parasites in maximum likelihood graphs are siblings. For
the heteroallelic data, all intra-episode parasites in maximum
likelihood graphs are strangers. Both have the same maximum
probabilities of recrudescence.</p>
<p>One upshot of this is that maximum probabilities could be increased
by increasing counts of intra-episode siblings. Arguably, maximum
probabilities should not increase with more than two intra-episode
siblings because siblings are not independent. In practice, when MOIs
under the Pv3Rs model are based on realistic MOI estimates, groups of
three or more siblings are modelled as groups of two; see <a href="intra-episode-siblings.html">vignette(“intra-episode-siblings”)</a>.</p>
<p>END OF DIGRESSION</p>
</div>
</div>
<div class="section level3">
<h3 id="increasing-episode-counts">Increasing episode counts<a class="anchor" aria-label="anchor" href="#increasing-episode-counts"></a>
</h3>
<p>Recurrences can be added without adding data</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ys_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"1_recurrence"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>                                       recur1 <span class="op">=</span> <span class="va">all_As</span><span class="op">)</span>,</span>
<span>                 <span class="st">"2_recurrence"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>                                       recur1 <span class="op">=</span> <span class="va">all_As</span>,</span>
<span>                                       recur2 <span class="op">=</span> <span class="va">no_data</span><span class="op">)</span>,</span>
<span>                 <span class="st">"3_recurrence"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>                                       recur1 <span class="op">=</span> <span class="va">all_As</span>,</span>
<span>                                       recur2 <span class="op">=</span> <span class="va">no_data</span>,</span>
<span>                                       recur3 <span class="op">=</span> <span class="va">no_data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ys_mismatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"1_recurrence"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>                                          recur1 <span class="op">=</span> <span class="va">all_Bs</span><span class="op">)</span>,</span>
<span>                    <span class="st">"2_recurrence"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>                                          recur1 <span class="op">=</span> <span class="va">all_Bs</span>,</span>
<span>                                          recur2 <span class="op">=</span> <span class="va">no_data</span><span class="op">)</span>,</span>
<span>                    <span class="st">"3_recurrence"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>                                          recur1 <span class="op">=</span> <span class="va">all_Bs</span>,</span>
<span>                                          recur2 <span class="op">=</span> <span class="va">no_data</span>,</span>
<span>                                          recur3 <span class="op">=</span> <span class="va">no_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The marginal probability that the first recurrence is a recrudescence
/ reinfection depends on the total number of recurrences:</p>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-24-1.png" width="100%"></p>
<p>An example of how recrudescence probabilities converge to their
maxima over 1, 2, 5 and 100 markers:</p>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-25-1.png" width="100%"></p>
<p>Note that the above maxima are not bounds imposed by the prior: they
are based on knowledge that there are no recurrent data on all but the
first recurrence; see <a href="graph-prior.pdf">vignette(“graph-prior”)</a>.</p>
</div>
<div class="section level3">
<h3 id="position-in-a-sequence">Position in a sequence<a class="anchor" aria-label="anchor" href="#position-in-a-sequence"></a>
</h3>
<p>Because the distribution over relationship graphs is not invariant to
different orderings of states in a sequence (more graphs are compatible
with a reinfection at the beginning versus the end of a sequence of
three episodes, for example), the position of a recurrence in a sequence
has a bearing on posterior estimates.</p>
<p>This effect is negligible when all episodes have the same data on
many markers:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>          recur1 <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>          recur2 <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>          recur3 <span class="op">=</span> <span class="va">all_As</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span></span>
<span><span class="co">#&gt;                C         L            I</span></span>
<span><span class="co">#&gt; recur1 0.7720588 0.2279412 5.585675e-23</span></span>
<span><span class="co">#&gt; recur2 0.7720588 0.2279412 5.316220e-23</span></span>
<span><span class="co">#&gt; recur3 0.7720588 0.2279412 5.044004e-23</span></span></code></pre></div>
<p>Instead, consider sequences of episodes with observations (Os) and
episodes with no data (Ns):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ys_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"NOO"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">no_data</span>, </span>
<span>                              recur1 <span class="op">=</span> <span class="va">all_As</span>,</span>
<span>                              recur2 <span class="op">=</span> <span class="va">all_As</span><span class="op">)</span>,</span>
<span>                 <span class="st">"ONO"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>                              recur1 <span class="op">=</span> <span class="va">no_data</span>,</span>
<span>                              recur2 <span class="op">=</span> <span class="va">all_As</span><span class="op">)</span>,</span>
<span>                 <span class="st">"OON"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>                              recur1 <span class="op">=</span> <span class="va">all_As</span>,</span>
<span>                              recur2 <span class="op">=</span> <span class="va">no_data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ys_mismatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"NOO"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">no_data</span>, </span>
<span>                                 recur1 <span class="op">=</span> <span class="va">all_As</span>,</span>
<span>                                 recur2 <span class="op">=</span> <span class="va">all_Bs</span><span class="op">)</span>,</span>
<span>                    <span class="st">"ONO"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>                                 recur1 <span class="op">=</span> <span class="va">no_data</span>,</span>
<span>                                 recur2 <span class="op">=</span> <span class="va">all_Bs</span><span class="op">)</span>, </span>
<span>                    <span class="st">"OON"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, </span>
<span>                                 recur1 <span class="op">=</span> <span class="va">all_Bs</span>,</span>
<span>                                 recur2 <span class="op">=</span> <span class="va">no_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-28-1.png" width="100%"></p>
<div class="section level4">
<h4 id="highly-informed-recurrences">Highly informed recurrences<a class="anchor" aria-label="anchor" href="#highly-informed-recurrences"></a>
</h4>
<p>The first recurrence in the sequence <span style="color: purple;">O<strong>O</strong>N</span> (upward purple 1
triangle) has a slightly lower probability of recrudescence than second
recurrence in the sequence <span style="color: darkgreen;">NO<strong>O</strong></span> (upward green 2
triangle) despite both recurrences having the same rare observations
that match the directly preceding episode.</p>
<p>The first recurrence in the sequence <span style="color: purple;">O<strong>O</strong>N</span> (downward purple 1
triangle) has a slightly higher probability of reinfection than the
second recurrence in the sequence <span style="color: darkgreen;">NO<strong>O</strong></span> (downward green 2
triangle) despite both recurrences having the same observations that
mismatch the directly preceding episode.</p>
</div>
<div class="section level4">
<h4 id="weakly-and-uninformed-recurrences">Weakly and uninformed recurrences<a class="anchor" aria-label="anchor" href="#weakly-and-uninformed-recurrences"></a>
</h4>
<p>Unsurprisingly, the posterior of the first recurrence in the sequence
<span style="color: darkgreen;">N<strong>O</strong>O</span> is close to
the prior (it has no preceding data), likewise for the second recurrence
in the sequence of <span style="color: purple;">OO<strong>N</strong></span> (it has no data).
More surprisingly, the posterior of the first recurrence of the sequence
<span style="color:
darkorange;">O<strong>N</strong>O</span> is not close to the prior,
despite having no data. On closer inspection, this is not so surprising
for reasons explained below.</p>
<p>For match data (upward triangles), strong evidence for a clonal edge
between episodes one and three in <span style="color: darkorange;"><strong>O</strong>N<strong>O</strong></span>
is incompatible with all recurrence sequences ending with reinfection
<em>and</em> reinfection followed by recrudescence, informing strongly
the second recurrence and weakly the first recurrence. By comparison,
strong evidence for a clonal edge between episodes two and three in
<span style="color: darkgreen;">N<strong>OO</strong></span> is
incompatible with all sequences of recurrences ending with reinfection,
informing the second recurrence only; likewise, strong evidence for a
clonal edge between episodes one and two in <span style="color: purple;"><strong>OO</strong>N</span> is incompatible with
all sequences of recurrences starting with reinfection, informing the
first recurrence only.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span> <span class="co"># Very small probability</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">ys_match</span><span class="op">[[</span><span class="st">"ONO"</span><span class="op">]</span><span class="op">]</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">joint</span> <span class="op">&lt;</span> <span class="va">epsilon</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "IC" "CI" "LI" "II"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">ys_match</span><span class="op">[[</span><span class="st">"NOO"</span><span class="op">]</span><span class="op">]</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">joint</span> <span class="op">&lt;</span> <span class="va">epsilon</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CI" "LI" "II"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">ys_match</span><span class="op">[[</span><span class="st">"OON"</span><span class="op">]</span><span class="op">]</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">joint</span> <span class="op">&lt;</span> <span class="va">epsilon</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "IC" "IL" "II"</span></span></code></pre></div>
<p>On close inspection the upward orange 1 triangle makes intuitive
sense: if you know a first recurrence is followed by a second MOI = 1
recurrence that is a clone of the MOI = 1 enrolment episode, it is very
unlikely the second recurrence is a clone drawn from a new mosquito as
it would be if it were a recrudescence of a reinfection. As such, the
data on the enrolment episode and the second recurrence tell us
something about the first recurrence, and thus the posterior estimate of
the first recurrence deviates from the prior even though the first
recurrence has no data.</p>
<p>The explanation for mismatch data (downward triangles) in the
sequence <span style="color:
darkorange;">ONO</span> is similar to that for match data: strong
evidence for a stranger edge between episodes one and three is
incompatible with a double recrudescence, so the posterior of the first
recurrence (downward orange 1 triangle) deviates from the prior despite
the first recurrence having no data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span> <span class="co"># Very small probability</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">ys_mismatch</span><span class="op">[[</span><span class="st">"ONO"</span><span class="op">]</span><span class="op">]</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">joint</span> <span class="op">&lt;</span> <span class="va">epsilon</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CC"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">ys_mismatch</span><span class="op">[[</span><span class="st">"NOO"</span><span class="op">]</span><span class="op">]</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">joint</span> <span class="op">&lt;</span> <span class="va">epsilon</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CC" "LC" "IC"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">ys_mismatch</span><span class="op">[[</span><span class="st">"OON"</span><span class="op">]</span><span class="op">]</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">joint</span> <span class="op">&lt;</span> <span class="va">epsilon</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CC" "CL" "CI"</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="interpreting-uncertainty">Interpreting uncertainty<a class="anchor" aria-label="anchor" href="#interpreting-uncertainty"></a>
</h2>
<p>Uncertain posterior estimates can be uncertain for two reasons that
are not mutually exclusive:</p>
<ol style="list-style-type: decimal">
<li>more data are needed</li>
<li>the states are not fully identifiable</li>
</ol>
<p>It is also important to bear in mind the fact that, under the Pv3Rs
model, trial participants with different epside counts and per-episode
MOIs have different maximum probabilities of recrudescence /
reinfection. For example, if we use a common threshold of 0.8 to
classify probable reinfection assuming recurrence states are equally
likely <em>a priori</em>, we can discount <em>a priori</em> all trail
participants with a single monoclonal recurrence following a monoclonal
enrolment episode because their posterior reinfection probabilities will
never exceed 0.75, even if their data are highly informative of
reinfection:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enrol <span class="op">=</span> <span class="va">all_As</span>, recur <span class="op">=</span> <span class="va">all_Bs</span><span class="op">)</span></span>
<span><span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ms</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using the default uniform prior on recurrent states</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span></span>
<span><span class="co">#&gt;       C    L    I</span></span>
<span><span class="co">#&gt; recur 0 0.25 0.75</span></span>
<span></span>
<span><span class="co"># Using a non-uniform prior on recurrent states</span></span>
<span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"C"</span> <span class="op">=</span> <span class="fl">0.25</span>, <span class="st">"L"</span> <span class="op">=</span> <span class="fl">0.25</span>, <span class="st">"I"</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">fs</span>, <span class="va">prior</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span></span>
<span><span class="co">#&gt;       C         L         I</span></span>
<span><span class="co">#&gt; recur 0 0.1428571 0.8571429</span></span></code></pre></div>
<p>And that, for a given trial participant, the probability of
recrudescence / reinfection depends on its position within a sequence,
especially if one or more episodes has no data.</p>
</div>
<div class="section level2">
<h2 id="meiotic-siblings">Meiotic siblings<a class="anchor" aria-label="anchor" href="#meiotic-siblings"></a>
</h2>
<div class="section level3">
<h3 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h3>
<p>We simulated data and generated results for an initial infection
containing two or three meiotic siblings and a recurrent</p>
<ul>
<li>stranger</li>
<li>clone</li>
<li>regular sibling</li>
<li>meiotic sibling</li>
</ul>
<p>Posterior probabilities are computed assuming recurrent states are
equally likely <em>a priori</em>.</p>
</div>
<div class="section level3">
<h3 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h3>
<p>When the initial infection contains two meiotic siblings
<code>compute_posterior</code> is well behaved with maximum likelihood
on the true relationship graph (not shown). Posterior probabilities
converge to</p>
<ul>
<li>probable reinfection when the recurrent parasite is a stranger,</li>
<li>probable recrudescence when the recurrent parasite is a clone,</li>
<li>certain relapse when the recurrent parasite is a regular
sibling,</li>
<li>certain relapse when the recurrent parasite is a meiotic
sibling.</li>
</ul>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-32-1.png" width="100%"><img src="understand-posterior_files/figure-html/unnamed-chunk-32-2.png" width="100%"><img src="understand-posterior_files/figure-html/unnamed-chunk-32-3.png" width="100%"><img src="understand-posterior_files/figure-html/unnamed-chunk-32-4.png" width="100%"></p>
<p>When the initial infection contains three meiotic siblings and the
recurrent parasite is either a stranger or a clone, posterior
probabilities converge correctly to probable reinfection and probable
recrudescence, respectively, but with maximal values given by graphs
over relationships between two, not three, parasites in the initial
infection.</p>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-33-1.png" width="100%"><img src="understand-posterior_files/figure-html/unnamed-chunk-33-2.png" width="100%"></p>
<p>Relationship graphs (not shown) are wrong for two reasons:</p>
<ul>
<li>all the relationship graphs have two, not three, parasites in the
initial infection because there are at most two alleles per marker.
Although technically incorrect, this behaviour is arguably desirable
(see digression above).</li>
<li>the highest likelihood relationship graphs have stranger parasites
in the initial episode because prevalence data from three or four
meiotic siblings are identical to bulk data from the parents who are
strangers.</li>
</ul>
<p>We can force the graphs to have three distinct parasites in the
initial episode by specifying external MOIs. Doing so recovers maximum
likelihood on true relationship graphs. However, the correct MOIs are
unknowable in practice: a collection of siblings from two parents can
only ever be as diverse as the two parents.</p>
<p>When the initial infection contains three meiotic siblings and the
recurrent parasite is a regular or meiotic sibling, posterior
probabilities converge to probable recrudescence with maximum likelihood
on graphs with a clonal edge to the sibling relapse, and either two
stranger parasites in the initial episode when no external MOIs are
specified, or three sibling parasites in the initial episode when the
correct MOIs (unknowable in practice) are provided externally.</p>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-34-1.png" width="100%"><img src="understand-posterior_files/figure-html/unnamed-chunk-34-2.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="half-siblings">Half siblings<a class="anchor" aria-label="anchor" href="#half-siblings"></a>
</h2>
<div class="section level3">
<h3 id="methods-1">Methods<a class="anchor" aria-label="anchor" href="#methods-1"></a>
</h3>
<p>We simulated data for three half siblings: two in an initial episode,
the third in a recurrence:</p>
<ul>
<li>child of parents 1 and 2 in the initial episode</li>
<li>child of parents 1 and 3 in the initial episode</li>
<li>child of parents 2 and 3 in the recurrence</li>
</ul>
<p>We explored two scenarios: one where all parental parasites draw from
the same allele distribution. Another with admixture where parent 1
draws alleles disproportionally to parents 2 and 3. The admixture
scenario is improbable. We explore it because it is a worse case
scenario: it is contrived to maximally hamper relapse
classification.</p>
</div>
<div class="section level3">
<h3 id="results-1">Results<a class="anchor" aria-label="anchor" href="#results-1"></a>
</h3>
<p>In general, when parental parasites draw from the same allele
distribution, the frequency of certain relapse increases erratically
with the number of markers genotyped.</p>
<p>For this particular case where there are three equifrequent alleles
per marker, we can show theoretically that the system behaves
erratically because a small perturbation to the ratio of observations
(all alleles match across the three half siblings, all alleles are
different, intra-episode alleles match, inter-episode alleles match) can
lead to a large deviation in the odds of relapse versus reinfection; see
<a href="half-siblings.pdf">vignette(“half-siblings”)</a>. The purple,
red, and green trajectories below have higher than the expected 0.5
intra-to-inter match ratios; moreover, the purple trajectory’s
intra-to-inter match ratio consistently exceeds
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>×</mo><msub><mtext mathvariant="normal">log</mtext><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mfrac displaystyle="true"><mn>2</mn><mn>5</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">0.5\times \text{log}_2(\dfrac{2}{5})</annotation></semantics></math>,
a condition found theoretically to concentrate posterior probability on
reinfection under certain conditions; again, see <a href="half-siblings.pdf">vignette(“half-siblings”)</a>.</p>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-35-1.png" width="100%">
When intra-episode parasites systematically share rare alleles
(admixture AND imbalanced allele frequencies), the frequency of probable
reinfection increases erratically with the number of markers
genotyped.</p>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-36-1.png" width="100%">
In both scenarios, the likelihood of the true graph with siblings within
and across episodes is quashed as soon as distinct alleles from all
three parents are observed at a given marker. In general,</p>
<ul>
<li>when all parasites draw from the same allele distribution, the
maximum likelihood graphs are the two with one inter-episode sibling
edge.</li>
<li>when intra-episode parasites systematically share rare alleles, the
maximum likelihood graph is the one with one intra-episode sibling
edge.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="parent-child-like-siblings">Parent-child like siblings<a class="anchor" aria-label="anchor" href="#parent-child-like-siblings"></a>
</h2>
<div class="section level3">
<h3 id="methods-2">Methods<a class="anchor" aria-label="anchor" href="#methods-2"></a>
</h3>
<p>We simulated data for three parent-child like siblings:</p>
<ul>
<li>child of selfed parent 1 in the initial episode</li>
<li>child of parents 1 and 2 in the initial episode</li>
<li>child of selfed parent 2 in the recurrence</li>
</ul>
<p>Aside: the alternative with both children of selfed parents in the
initial episode is equivalent to the meiotic case above with three
mieotic siblings in the initial episode because prevalence data from
three meiotic siblings is equivalent to prevalence data from two
stranger parents and leads to probable recrudescence rather than certain
relapse with the number of markers genotyped.</p>
<p>As for half-siblings, we explored two scenarios: one where all
parental parasites draw from the same allele distribution. Another with
admixture where parent 1 draws alleles disproportionally to parents 2
and 3. The admixture scenario is improbable. We explore it because it is
a worse case scenario: it is contrived to maximally hamper relapse
classification.</p>
</div>
<div class="section level3">
<h3 id="results-2">Results<a class="anchor" aria-label="anchor" href="#results-2"></a>
</h3>
<p>When parental parasites draw from the same allele distribution, the
frequency of certain relapse increases erratically with the number of
markers genotyped.</p>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-37-1.png" width="100%"></p>
<p>When intra-episode parasites systematically share rare alleles
(admixture AND imbalanced allele frequencies), the frequency of probable
reinfection increases erratically with the number of markers
genotyped.</p>
<p><img src="understand-posterior_files/figure-html/unnamed-chunk-38-1.png" width="100%"></p>
<p>In general, when all parasites draw from the same allele
distribution, the maximum likelihood graph is the true graph with
siblings within and across episodes. Meanwhile, when intra-episode
parasites systematically share rare alleles, the maximum likelihood
graph is the one with one intra-episode sibling edge.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Aimee Taylor, Yong See Foo, European Union, Project 101110393 — PvRecur.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
