<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Understand genotyping errors • Pv3Rs</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Understand genotyping errors">
<meta name="description" content="Investigates and diagnoses missclassification due to genotyping errors and *de novo* mutations">
<meta property="og:description" content="Investigates and diagnoses missclassification due to genotyping errors and *de novo* mutations">
<meta property="og:image" content="https://aimeertaylor.github.io/Pv3Rs/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Pv3Rs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/aimeertaylor/Pv3Rs/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Understand genotyping errors</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/aimeertaylor/Pv3Rs/blob/main/vignettes/articles/genotyping-errors.Rmd" class="external-link"><code>vignettes/articles/genotyping-errors.Rmd</code></a></small>
      <div class="d-none name"><code>genotyping-errors.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Pv3Rs’ statistical model does not account for genotyping errors and
<em>de novo</em> mutations, which can lead to misclassification. In this
article, we demonstrate that the primary consequence of such model
misspecifications is the risk of mistaking recrudescence as near-certain
relapse. Intuitively, this is caused by the model’s rigid expectation
for all alleles observed from a recrudescence episode to have been
observed in the preceding episode. If there are <em>de novo</em>
mutations or genotyping false positives in the recrudescence episode
that lead to alleles that are not observed in the preceding episode,
Pv3Rs will incorrectly eliminate the possibility of recrudescence. The
same applies in the case of allele dropouts or genotyping false
negatives in the preceding episode.</p>
<p>Mistaking recrudescence as near-certain relapse is inconsequential
when recrudescence and relapse probabilities are combined, e.g., in
estimations of radical cure efficacy. Otherwise, care needs to be taken
when interpreting a near-certain relapse output from Pv3Rs, as it may
correspond to a genuine relapse, or a recrudescence that is obscured by
genotyping errors and/or <em>de novo</em> mutations. Assuming a small
error rate and given a sufficient marker count, these two cases can be
distinguished by inspecting the proportion of mismatched markers —
markers that are incompatible with recrudescence because there is some
allele observed in the recurrence that is absent in the preceding
episode. If the proportion of mismatched markers aligns the expected
error rate, one can consider rerunning Pv3Rs without the mismatched
markers. For a genuine relapse, the proportion of mismatched markers
should be higher.</p>
<p>Another consequence of genotyping error, specifically false
positivity, is spuriously high multiplicity of infection. Because there
is a computational limit on the total genotype count (we do not
recommend running Pv3Rs on participant data where per-episode
multiplicities of infection sum to nine or more), false positives might
render some recurrences unanalysable. Among those that are analysable,
false postives might impact probable recrudescence and probable
reinfection probabilities because different parasite genotype counts
induce different posterior bounds on these states.</p>
</div>
<div class="section level2">
<h2 id="data-simulation">Data simulation<a class="anchor" aria-label="anchor" href="#data-simulation"></a>
</h2>
<p>Let us generate some data based on the following three relationship
graphs, each with four genotypes g1, g2, g3, and g4:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>, mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="va">RGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/enumerate_RGs.html">enumerate_RGs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">34</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/plot_RG.html">plot_RG</a></span><span class="op">(</span><span class="va">RGs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, vertex.size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="genotyping-errors_files/figure-html/unnamed-chunk-2-1.png" width="100%"></p>
<p>Each relationship graph consists of two parasite genotypes during the
enrolment episode and two parasite genotypes during the recurrence
episode. We’ve chosen these relationship graphs such that only the first
relationship graph is compatible with recrudescence, and only the last
relationship graph is compatible with reinfection. Below is some code to
simulate data based on these relationship graphs. For each relationship
graph, ten data sets are simulated. For each data set, data on 50
octo-allelic markers are simulated per genotype. An internal function
(<code>Pv3Rs:::recombine_parent_ids</code>) ensures the finite nature of
the parasite genome (not accounted for under the Pv3Rs model) is
captured in the simulation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-gregmisc/gtools" class="external-link">gtools</a></span><span class="op">)</span> <span class="co"># for `rdirichlet`</span></span>
<span></span>
<span><span class="va">N_CHRS</span> <span class="op">&lt;-</span> <span class="fl">14</span> <span class="co"># P. vivax has 14 chromosomes</span></span>
<span></span>
<span><span class="co"># simulate allele frequencies for multiple markers</span></span>
<span><span class="co"># assumes each marker has the same number of alleles</span></span>
<span><span class="va">sim_fs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_m</span>, <span class="va">n_a</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_m</span><span class="op">)</span> <span class="co"># marker names</span></span>
<span>  <span class="va">n_a_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">n_a</span>, <span class="va">n_m</span><span class="op">)</span>, <span class="va">markers</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">n_a_vec</span>, <span class="kw">function</span><span class="op">(</span><span class="va">n_a</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">alleles</span> <span class="op">&lt;-</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n_a</span><span class="op">]</span> <span class="co"># n_a &lt;= 26</span></span>
<span>    <span class="va">fs_unnamed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/gtools/man/dirichlet.html" class="external-link">rdirichlet</a></span><span class="op">(</span><span class="fl">1</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n_a</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">fs_unnamed</span>, <span class="va">alleles</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sim_RG1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_m</span>, <span class="va">n_a</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu">sim_fs</span><span class="op">(</span><span class="va">n_m</span>, <span class="va">n_a</span><span class="op">)</span></span>
<span>  <span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, <span class="fl">2</span>, <span class="cn">TRUE</span>, <span class="va">f</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>init <span class="op">=</span> <span class="va">init</span>, recur <span class="op">=</span> <span class="va">init</span><span class="op">)</span>, fs <span class="op">=</span> <span class="va">fs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sim_RG2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_m</span>, <span class="va">n_a</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">chrs_per_marker</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_m</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n_m</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">N_CHRS</span><span class="op">)</span></span>
<span>  <span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu">sim_fs</span><span class="op">(</span><span class="va">n_m</span>, <span class="va">n_a</span><span class="op">)</span></span>
<span>  <span class="va">parents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, <span class="fl">2</span>, <span class="cn">TRUE</span>, <span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">sib1</span> <span class="op">&lt;-</span> <span class="fu">Pv3Rs</span><span class="fu">:::</span><span class="fu">recombine_parent_ids</span><span class="op">(</span><span class="va">chrs_per_marker</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="co"># full siblings</span></span>
<span>  <span class="va">sib2</span> <span class="op">&lt;-</span> <span class="fu">Pv3Rs</span><span class="fu">:::</span><span class="fu">recombine_parent_ids</span><span class="op">(</span><span class="va">chrs_per_marker</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="co"># full siblings</span></span>
<span>  <span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_m</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">parents</span><span class="op">[[</span><span class="va">m</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">sib1</span><span class="op">[</span><span class="va">m</span><span class="op">]</span><span class="op">]</span>, <span class="va">clone</span><span class="op">[[</span><span class="va">m</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">recur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_m</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">parents</span><span class="op">[[</span><span class="va">m</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">sib2</span><span class="op">[</span><span class="va">m</span><span class="op">]</span><span class="op">]</span>, <span class="va">clone</span><span class="op">[[</span><span class="va">m</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>init <span class="op">=</span> <span class="va">init</span>, recur <span class="op">=</span> <span class="va">recur</span><span class="op">)</span>, fs <span class="op">=</span> <span class="va">fs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sim_RG3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_m</span>, <span class="va">n_a</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">chrs_per_marker</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_m</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n_m</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">N_CHRS</span><span class="op">)</span></span>
<span>  <span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu">sim_fs</span><span class="op">(</span><span class="va">n_m</span>, <span class="va">n_a</span><span class="op">)</span></span>
<span>  <span class="va">parents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, <span class="fl">2</span>, <span class="cn">TRUE</span>, <span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">sib1</span> <span class="op">&lt;-</span> <span class="fu">Pv3Rs</span><span class="fu">:::</span><span class="fu">recombine_parent_ids</span><span class="op">(</span><span class="va">chrs_per_marker</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="co"># full siblings</span></span>
<span>  <span class="va">sib2</span> <span class="op">&lt;-</span> <span class="fu">Pv3Rs</span><span class="fu">:::</span><span class="fu">recombine_parent_ids</span><span class="op">(</span><span class="va">chrs_per_marker</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="co"># full siblings</span></span>
<span>  <span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_m</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">parents</span><span class="op">[[</span><span class="va">m</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sib1</span><span class="op">[</span><span class="va">m</span><span class="op">]</span>, <span class="va">sib2</span><span class="op">[</span><span class="va">m</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">recur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, <span class="fl">2</span>, <span class="cn">TRUE</span>, <span class="va">f</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>init <span class="op">=</span> <span class="va">init</span>, recur <span class="op">=</span> <span class="va">recur</span><span class="op">)</span>, fs <span class="op">=</span> <span class="va">fs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">n_datasets</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># 10 datasets per relationship graph</span></span>
<span><span class="va">n_m</span> <span class="op">&lt;-</span> <span class="fl">50</span> <span class="co"># 50 markers</span></span>
<span><span class="va">n_a</span> <span class="op">&lt;-</span> <span class="fl">8</span> <span class="co"># 8 possible alleles per marker (same as benchmarking)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">datasets_RG1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">n_m</span>, <span class="va">n_datasets</span><span class="op">)</span>, <span class="va">sim_RG1</span>, <span class="va">n_a</span><span class="op">)</span></span>
<span><span class="va">datasets_RG2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">n_m</span>, <span class="va">n_datasets</span><span class="op">)</span>, <span class="va">sim_RG2</span>, <span class="va">n_a</span><span class="op">)</span></span>
<span><span class="va">datasets_RG3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">n_m</span>, <span class="va">n_datasets</span><span class="op">)</span>, <span class="va">sim_RG3</span>, <span class="va">n_a</span><span class="op">)</span></span>
<span><span class="va">all_datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">datasets_RG1</span>, <span class="va">datasets_RG2</span>, <span class="va">datasets_RG3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pv3rs-on-error-free-data">Pv3Rs on error-free data<a class="anchor" aria-label="anchor" href="#pv3rs-on-error-free-data"></a>
</h2>
<p>Before simulating errors, we show the output of Pv3Rs meets our
expectations when the model is fit to error-free data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posts_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">all_datasets</span>, <span class="va">lapply</span>,</span>
<span>                     <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span>, <span class="va">data</span><span class="op">$</span><span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>, mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">posts_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">post</span><span class="op">)</span> <span class="va">post</span><span class="op">$</span><span class="va">marg</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/plot_simplex.html">plot_simplex</a></span><span class="op">(</span>p.coords <span class="op">=</span> <span class="va">probs</span>, lim.mar <span class="op">=</span> <span class="fl">0.15</span>, p.labels <span class="op">=</span> <span class="cn">NA</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"top"</span>, pch <span class="op">=</span> <span class="fl">1</span>, pt.cex <span class="op">=</span> <span class="fl">2</span>, bty <span class="op">=</span> <span class="st">"n"</span>, inset <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                    legend <span class="op">=</span> <span class="st">"Error-free"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="genotyping-errors_files/figure-html/unnamed-chunk-5-1.png" width="100%">
In the error-free case, the posterior probabilities concentrate on
recrudescence, relapse, and reinfection for the three relationship
graphs respectively. Note that there are ten points per simplex: one per
data set, ten data sets per relationship graph; all the probabilities
per simplex are almost identical and thus the points overlap. The
physical size of the plotting marker is not quantitatively meaningful;
its role is to visually distinguish other plotting markers in later
plots.</p>
</div>
<div class="section level2">
<h2 id="error-simulation">Error simulation<a class="anchor" aria-label="anchor" href="#error-simulation"></a>
</h2>
<p>Now, we introduce errors into our data. We distinguish three types of
misspecifications:</p>
<ul>
<li><p><em>False negatives.</em> The genotyping procedure may fail to
detect alleles, e.g., because they are carried by parasites that are
present at low densities in the blood sample. Such allele dropouts can
incorrectly eliminate the possibility of recrudescence: alleles from a
recrudescence episode may not be able to be matched to the preceding
episode if it suffers from false negatives. False negatives can also
arise from micalls (see below).</p></li>
<li><p><em>False positives.</em> This refers to additional alleles
called by the genotyping procedure that are not truly present. Again,
false positives may incorrectly eliminate the possibility of
recrudescence if the recurrence suffers from false positives.</p></li>
<li><p><em>Miscalls.</em> This refers to mistaking an allele for another
allele. One can view this as a false negative and false positive
occurring together. <em>De novo</em> mutations can be viewed
similarly.</p></li>
</ul>
<p>For each marker and each episode, we independently modify the
observed data with a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">2\%</annotation></semantics></math>
probability, using either a false negative, false positive, or miscall.
If more than one allele is observed, all three misspecifications have
equal probabilities. Otherwise, to avoid missing alleles, a false
positive or miscall is simulated with equal probability. (Pv3Rs deals
well with missing alleles: including them as errors here would be an
eschewal.) We then run Pv3Rs on the modified datasets.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modify</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">orig</span>, <span class="va">n_a</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">orig</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span> <span class="co"># false negative</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">orig</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">orig</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># both false positive and miscall involve an "extra" allele</span></span>
<span>  <span class="va">extra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n_a</span><span class="op">]</span>, <span class="va">orig</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span> <span class="co"># false positive</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">orig</span>, <span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="co"># miscall</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">orig</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">orig</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">modified</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">datasets_RG1</span>, <span class="va">datasets_RG2</span>, <span class="va">datasets_RG3</span><span class="op">)</span></span>
<span><span class="va">p.modify</span> <span class="op">&lt;-</span> <span class="fl">0.02</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_datasets</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span> <span class="co"># episode</span></span>
<span>      <span class="kw">for</span><span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_m</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">p.modify</span><span class="op">)</span> <span class="kw">next</span></span>
<span>        <span class="va">modified</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">y</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">m</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">modify</span><span class="op">(</span><span class="va">modified</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">y</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">m</span><span class="op">]</span><span class="op">]</span>, <span class="va">n_a</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mposts_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">modified</span>, <span class="va">lapply</span>,</span>
<span>                     <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/compute_posterior.html">compute_posterior</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span>, <span class="va">data</span><span class="op">$</span><span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>, mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">posts_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">post</span><span class="op">)</span> <span class="va">post</span><span class="op">$</span><span class="va">marg</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">mprobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mposts_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">mpost</span><span class="op">)</span> <span class="va">mpost</span><span class="op">$</span><span class="va">marg</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/plot_simplex.html">plot_simplex</a></span><span class="op">(</span>p.coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">probs</span>, <span class="va">mprobs</span><span class="op">)</span>, lim.mar <span class="op">=</span> <span class="fl">0.15</span>, p.labels <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>               col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.3</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">n_datasets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">n_datasets</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">20</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">n_datasets</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"top"</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">20</span><span class="op">)</span>, pt.cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span>, inset <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Error-free"</span>, <span class="st">"With errors"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="genotyping-errors_files/figure-html/unnamed-chunk-7-1.png" width="100%">
As predicted, the presence of errors causes probable recrudescence to be
classified as near-certain relapse. (Remember that there are ten
probabilities per simplex: one per data set, ten data sets per
relationship graph; almost all the probabilities per simplex are the
same and thus the points overlap.) Also, there are some datasets
corresponding to the third relationship graph where the reinfection
probability is overestimated. This is likley due to a false positives
changing the posterior bound.</p>
</div>
<div class="section level2">
<h2 id="diagnosis">Diagnosis<a class="anchor" aria-label="anchor" href="#diagnosis"></a>
</h2>
<p>In a practical scenario, we do not know the underlying relationship
graph, and so cannot distinguish between the first two simplices from
posterior probabilities (based on data with errors) alone, where Pv3Rs
outputs near-certain relapse. As alluded to in the introduction, we
propose that these two cases can be distinguished by a simple
diagnostic, that is, the proportion of mismatched markers.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># count how many markers have some allele in epi1 but not in epi0</span></span>
<span><span class="va">count_recru_incompat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">epi0</span>, <span class="va">epi1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">y</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">x</span><span class="op">)</span>, <span class="va">epi0</span>, <span class="va">epi1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">incompat_prop_RG1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">modified</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                            <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu">count_recru_incompat</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">$</span><span class="va">init</span>, <span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">$</span><span class="va">recur</span><span class="op">)</span><span class="op">/</span><span class="va">n_m</span><span class="op">)</span></span>
<span><span class="va">incompat_prop_RG2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">modified</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                            <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu">count_recru_incompat</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">$</span><span class="va">init</span>, <span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">$</span><span class="va">recur</span><span class="op">)</span><span class="op">/</span><span class="va">n_m</span><span class="op">)</span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.02</span><span class="op">)</span></span>
<span><span class="va">h1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">incompat_prop_RG1</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">h2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">incompat_prop_RG2</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">h1</span><span class="op">$</span><span class="va">counts</span>, <span class="va">h2</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">counts</span>, beside <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yellow"</span>, <span class="st">"purple"</span><span class="op">)</span>,</span>
<span>        space <span class="op">=</span> <span class="fl">0</span>,  width <span class="op">=</span> <span class="fl">0.02</span>,</span>
<span>        axes <span class="op">=</span> <span class="cn">FALSE</span>, offset <span class="op">=</span> <span class="fl">0</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Proportion of mismatched markers"</span>,</span>
<span>        ylab <span class="op">=</span> <span class="st">"Number of datasets (with errors)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0.04</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"First relationship graph"</span>, <span class="st">"Second relationship graph"</span>, <span class="st">"Expected error rate"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yellow"</span>, <span class="st">"purple"</span>, <span class="st">"red"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="st">"-"</span>, pt.cex <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="genotyping-errors_files/figure-html/unnamed-chunk-8-1.png" width="100%">
We see that datasets from the first relationship graph (corresponding to
recrudescence with error-free data) have a much lower proportion of
mismatched markers compared to datasets from the second relationship
graph (corresponding to relapse with error-free data). This shows that
our proposed diagnostic is promising for detecting misclassification of
recrudescence as relapse. Since the per marker per episode error rate is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">2\%</annotation></semantics></math>,
we expect a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>4</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">\approx 4\%</annotation></semantics></math>
per marker error rate over two episodes, which matches the empirical
proportion of mismatched markers for the first relationship graph.</p>
<p>In practice, the proportion of mismatched markers given genuine
relapse may follow a different distribution depending on the allele
frequencies and the underlying relationship graph. Further simulation
studies may be useful for investigating how this diagnostic behaves
beyond the scenarios we consider here.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Aimee Taylor, Yong See Foo, European Union, Project 101110393.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
